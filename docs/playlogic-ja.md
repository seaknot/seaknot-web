---
PlayLogic
...


## 基本的なコンセプト

### 永続データ

**永続データ**とは、セーブデータに含められるデータであり、ゲーム内の全ての状態はこの永続データから計算できなくてはいけません。

ブール値を保存する**フラグ**と文字列を保存する**永続的文字列**があります。

永続データはユーザからの入力時に更新することができます。無限ループを避けるため、ユーザ入力を伴わない更新はしません。

### 状態

**状態**とは、ゲーム内の NPC などの振る舞いを決めるときの内部的な状態です。永続的データが更新された時に、関連する状態が自動的に更新されます。

状態は永続データからのみ決定されます。状態を直接更新することはできません。

### 永続データと状態のリンク

状態はかならず 1 個以上の永続データにリンクします。永続データとリンクしないと状態を更新する方法がありません。

また、1 個の永続データは複数の状態とリンクすることができます。

このリンク構造によって、永続データが更新された時に自動的に状態が更新され、この時に何らかの画面効果を伴うこともできます。
たとえば、NPC やアイテムを消したり表示させたりするなどです。

## ユーザ入力のハンドリング

永続データはユーザからの入力の際に更新されます。例えば、ユーザからの入力には、NPC に話しかける、アイテムを調べる、エリアトリガーに入るなどがあります。

ユーザ入力のハンドラで状態を更新してはいけません。ユーザ入力の際には、永続データの更新や一時的な画面効果を実行することができます。

複雑な例として、アイテムを調べると暗転し、画面が明るくなるとそのアイテムが消えている、というような効果が実装できます。

### NPC やオブジェクトとのインタラクション

NPC に話しかけると、インタラクションのイベントが発生します。アプリケーションでこのイベントのハンドラを自由に実装できます。

また、フィールド上に配置されているオブジェクトを調べることでもインタラクションのイベントが発生し、NPC と同様にこのイベントをハンドルできます。

### エリアトリガー

